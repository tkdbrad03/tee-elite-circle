<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="icon" type="image/png" href="/images/tee-elite-favicon.png">
  <title>The Circle â€” Tee Elite Invitational</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#163326">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Tee Elite">
  <link rel="apple-touch-icon" href="/images/apple-touch-icon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Jost:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="pwa-nav.css">
  <style>
    :root{
      --green:#163326;--green2:#1E3A2B;--gold:#A87C28;--gold2:#C9A24A;
      --gold-lt:#EDD9A3;--white:#FFFFFF;--off:#F8F7F4;--ink:#163326;
      --body:#2C2C2C;--muted:#555555;--line:rgba(0,0,0,.12);
      --serif:"Cormorant Garamond",Georgia,serif;
      --sans:"Jost",ui-sans-serif,system-ui,sans-serif;
      --tmac-bronze:#A87C28;--tmac-gold:#C9A24A;--tmac-blush:#e8ccc8;
      --tmac-blush-light:#f7f0ef;--deep-forest:#163326;--charcoal:#2C2C2C;
    }
    *,*::before,*::after{box-sizing:border-box}
    body{font-family:var(--sans);background:var(--white);color:var(--body);-webkit-font-smoothing:antialiased;}

    .page-container{max-width:900px;margin:0 auto;padding:40px 24px 120px}

    .page-header{margin-bottom:40px}
    .page-label{font-size:10px;letter-spacing:.3em;text-transform:uppercase;color:var(--gold);margin-bottom:8px}
    .page-title{font-family:var(--serif);font-size:clamp(32px,5vw,48px);font-weight:400;color:var(--ink);margin-bottom:10px}
    .page-title em{font-style:italic;color:var(--gold)}
    .page-subtitle{font-size:14px;color:var(--muted);max-width:500px;line-height:1.7;font-weight:300}

    .players-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:20px}

    .player-card{
      background:var(--white);border:1px solid var(--line);border-radius:20px;
      overflow:hidden;transition:all .25s ease;text-align:center;padding:28px 20px 0;
      display:flex;flex-direction:column;
    }
    .player-card:hover{transform:translateY(-4px);box-shadow:0 16px 32px rgba(0,0,0,.08)}

    .player-photo{
      width:90px;height:90px;border-radius:50%;
      background:var(--tmac-blush-light);display:flex;align-items:center;
      justify-content:center;overflow:hidden;margin:0 auto 16px;flex-shrink:0;
    }
    .player-photo img{width:100%;height:100%;object-fit:cover}
    .player-photo .initials{font-family:var(--serif);font-size:32px;color:var(--gold);opacity:.7}

    .player-name{font-family:var(--serif);font-size:20px;font-weight:500;color:var(--ink);margin-bottom:10px}

    .player-handicap{
      display:inline-block;
      background:var(--off);border:1px solid var(--line);
      border-radius:999px;padding:4px 14px;
      font-size:12px;font-weight:500;color:var(--ink);
      margin-bottom:8px;
    }
    .player-handicap span{color:var(--gold);font-weight:600}

    .player-course{
      font-size:12px;color:var(--muted);font-weight:300;
      margin-bottom:16px;line-height:1.5;
    }
    .player-course strong{color:var(--ink);font-weight:500}

    .player-spacer{flex:1}

    .send-msg-btn{
      display:block;text-align:center;padding:14px;
      font-size:11px;letter-spacing:.14em;text-transform:uppercase;
      font-weight:600;color:var(--green);
      background:linear-gradient(135deg,#C8A84B 0%,#E8D48A 35%,#F0E09A 50%,#D4A84A 70%,#B8922E 100%);
      border:none;cursor:pointer;
      margin:0 -20px;width:calc(100% + 40px);
      transition:all .2s ease;font-family:var(--sans);
      border-top:1px solid rgba(168,124,40,.2);
    }
    .send-msg-btn:hover{opacity:.88}

    .loading-state{text-align:center;padding:80px 24px;color:var(--muted);grid-column:1/-1;font-weight:300}

    /* Message modal */
    .modal-backdrop{
      position:fixed;inset:0;background:rgba(0,0,0,.45);
      display:none;align-items:center;justify-content:center;
      padding:24px;z-index:9999;backdrop-filter:blur(4px);
    }
    .modal-backdrop.open{display:flex}
    .modal{
      width:100%;max-width:440px;background:var(--white);
      border:1px solid var(--line);border-radius:20px;padding:32px 28px;
      animation:fadeUp .25s ease both;
    }
    @keyframes fadeUp{from{opacity:0;transform:translateY(14px)}to{opacity:1;transform:translateY(0)}}
    .modal h3{font-family:var(--serif);font-weight:400;color:var(--ink);font-size:28px;margin-bottom:6px}
    .modal p{font-size:14px;color:var(--muted);margin-bottom:20px;font-weight:300}
    .modal textarea{
      width:100%;padding:14px 18px;
      border:1.5px solid rgba(22,51,38,.18);border-radius:16px;
      font-family:var(--sans);font-size:14px;font-weight:300;
      color:var(--ink);resize:vertical;min-height:120px;outline:none;
      transition:border-color .2s;
    }
    .modal textarea:focus{border-color:var(--gold2)}
    .modal-actions{display:flex;flex-direction:column;gap:10px;margin-top:14px}
    .btn-gold{
      display:block;width:100%;padding:15px;
      background:linear-gradient(135deg,#C8A84B 0%,#E8D48A 35%,#F0E09A 50%,#D4A84A 70%,#B8922E 100%);
      color:var(--green);border:none;border-radius:999px;
      font-family:var(--sans);font-size:12px;letter-spacing:.14em;
      text-transform:uppercase;font-weight:700;cursor:pointer;
      box-shadow:0 8px 24px rgba(168,124,40,.26);transition:all .2s;
    }
    .btn-gold:hover{transform:translateY(-1px);box-shadow:0 12px 30px rgba(168,124,40,.34)}
    .btn-outline{
      display:block;width:100%;padding:15px;
      background:transparent;border:1.5px solid rgba(22,51,38,.22);
      border-radius:999px;color:var(--green);
      font-family:var(--sans);font-size:12px;letter-spacing:.14em;
      text-transform:uppercase;font-weight:500;cursor:pointer;transition:all .2s;
    }
    .btn-outline:hover{border-color:rgba(22,51,38,.4)}
    .msg-status{font-size:13px;color:var(--muted);text-align:center;margin-top:8px;min-height:20px}

    @media(max-width:900px){.players-grid{grid-template-columns:repeat(2,1fr)}}
    @media(max-width:600px){
      .players-grid{grid-template-columns:1fr}
      .page-container{padding-bottom:120px}
    }
  </style>
</head>
<body class="member-body">

  <header class="member-header">
    <div class="header-inner">
      <a href="/home.html" class="header-logo">
        <img src="images/tmac-logo.png" alt="TMac Inspired">
      </a>
      <nav class="header-nav">
        <a href="/home.html" class="nav-link">Hub</a>
        <a href="/tee-room.html" class="nav-link">Tee Room</a>
        <a href="/members.html" class="nav-link active">The Circle</a>
        <a href="/tee-elite-invitational.html" class="nav-link">The Invitational</a>
      </nav>
      <div class="header-user">
        <a href="/profile.html" class="user-avatar" id="user-avatar">
          <span id="user-initials">TM</span>
        </a>
      </div>
      <button class="mobile-menu-btn" id="mobile-menu-btn">
        <span></span><span></span><span></span>
      </button>
    </div>
  </header>

  <div class="mobile-nav" id="mobile-nav">
    <a href="/home.html" class="mobile-nav-link">Hub</a>
    <a href="/tee-room.html" class="mobile-nav-link">Tee Room</a>
    <a href="/members.html" class="mobile-nav-link active">The Circle</a>
    <a href="/tee-elite-invitational.html" class="mobile-nav-link">The Invitational</a>
    <a href="/profile.html" class="mobile-nav-link">My Profile</a>
  </div>

  <main class="page-container">
    <div class="page-header">
      <div class="page-label">Tee Elite Invitational 2026</div>
      <h1 class="page-title">The <em>Players</em></h1>
      <p class="page-subtitle">Meet the women joining you on the green. Connect before April 18.</p>
    </div>

    <div class="players-grid" id="players-grid">
      <div class="loading-state">Loading members...</div>
    </div>
  </main>

  <nav class="pwa-bottom-nav">
    <div class="pwa-bottom-nav-inner">
      <a href="/home.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>Hub
      </a>
      <a href="/tee-room.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>Tee Room
      </a>
      <a href="/members.html" class="pwa-nav-item active">
        <svg viewBox="0 0 24 24"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>Circle
      </a>
      <a href="/profile.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>Profile
      </a>
    </div>
  </nav>

  <!-- SEND MESSAGE MODAL -->
  <div class="modal-backdrop" id="msg-modal">
    <div class="modal">
      <h3 id="msg-modal-name">Send a Message</h3>
      <p>Your message will be sent to their registration email.</p>
      <textarea id="msg-body" placeholder="Write your message..."></textarea>
      <div class="msg-status" id="msg-status"></div>
      <div class="modal-actions">
        <button class="btn-gold" onclick="sendMessage()">Send Message</button>
        <button class="btn-outline" onclick="closeModal()">Cancel</button>
      </div>
    </div>
  </div>

  <script>
    let currentRecipient = null;

    document.getElementById('mobile-menu-btn').addEventListener('click', function() {
      this.classList.toggle('active');
      document.getElementById('mobile-nav').classList.toggle('open');
    });

    async function loadPlayers() {
      try {
        const res = await fetch('/api/members/get');
        if (!res.ok) {
          if (res.status === 401) { window.location.href = '/member-login.html'; return; }
          throw new Error('Failed to load members');
        }
        const players = await res.json();
        const grid = document.getElementById('players-grid');

        if (players.length === 0) {
          grid.innerHTML = '<div class="loading-state">No members yet.</div>';
          return;
        }

        grid.innerHTML = players.map(player => `
          <div class="player-card">
            <div class="player-photo">
              ${player.photo_url
                ? `<img src="${player.photo_url}" alt="${player.name}">`
                : `<span class="initials">${getInitials(player.name)}</span>`}
            </div>
            <h3 class="player-name">${player.name}</h3>
            ${player.handicap
              ? `<div class="player-handicap">Handicap <span>${player.handicap}</span></div>`
              : ''}
            ${player.favorite_course
              ? `<div class="player-course"><strong>Favorite course:</strong> ${player.favorite_course}</div>`
              : ''}
            <div class="player-spacer"></div>
            <button class="send-msg-btn" onclick="openModal('${player.name}', ${player.id})">Send Message</button>
          </div>
        `).join('');

        // Update user initials
        const meRes = await fetch('/api/members/me');
        if (meRes.ok) {
          const me = await meRes.json();
          document.getElementById('user-initials').textContent = getInitials(me.name);
        }
      } catch (err) {
        console.error('Error loading members:', err);
        document.getElementById('players-grid').innerHTML =
          '<div class="loading-state">Error loading members. Please refresh.</div>';
      }
    }

    function getInitials(name) {
      if (!name) return 'TM';
      return name.split(' ').map(n => n[0]).join('').toUpperCase().slice(0, 2);
    }

    function openModal(name, id) {
      currentRecipient = { name, id };
      document.getElementById('msg-modal-name').textContent = 'Message ' + name.split(' ')[0];
      document.getElementById('msg-body').value = '';
      document.getElementById('msg-status').textContent = '';
      document.getElementById('msg-modal').classList.add('open');
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      document.getElementById('msg-modal').classList.remove('open');
      document.body.style.overflow = '';
      currentRecipient = null;
    }

    document.getElementById('msg-modal').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    async function sendMessage() {
      if (!currentRecipient) return;
      const body = document.getElementById('msg-body').value.trim();
      if (!body) { document.getElementById('msg-status').textContent = 'Please write a message.'; return; }

      const status = document.getElementById('msg-status');
      status.textContent = 'Sending...';

      try {
        const res = await fetch('/api/members/send-message', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ recipient_id: currentRecipient.id, message: body })
        });

        if (res.ok) {
          status.textContent = 'Message sent!';
          setTimeout(() => closeModal(), 1500);
        } else {
          const data = await res.json();
          status.textContent = data.error || 'Something went wrong. Try again.';
        }
      } catch (err) {
        status.textContent = 'Something went wrong. Try again.';
      }
    }

    loadPlayers();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/service-worker.js')
          .then(r => console.log('SW registered:', r.scope))
          .catch(e => console.log('SW failed:', e));
      });
    }
  </script>

</body>
</html>
