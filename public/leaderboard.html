<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <title>Leaderboard — Tee Elite Invitational</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="icon" type="image/png" href="/images/tee-elite-favicon.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,500;0,600;1,400&family=Montserrat:wght@300;400;500;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css"> 
  <link rel="stylesheet" href="pwa-nav.css">
  <style>
    .lb-wrap { max-width: 600px; margin: 0 auto; padding: 24px 20px 100px; }

    /* PRACTICE BANNER */
    .practice-banner {
      background: #f39c12;
      color: #fff;
      text-align: center;
      padding: 10px 16px;
      font-size: 11px;
      letter-spacing: .22em;
      text-transform: uppercase;
      font-weight: 600;
    }
    .practice-banner.hidden { display: none; }

    /* HEADER STRIP */
    .lb-hero {
      background: var(--deep-forest);
      padding: 28px 24px 24px;
      margin-bottom: 24px;
      position: relative;
      overflow: hidden;
    }
    .lb-hero::before {
      content: '';
      position: absolute;
      bottom: 0; left: 0; right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--tmac-gold), var(--tmac-blush));
    }
    .lb-eyebrow {
      font-size: 10px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: var(--tmac-gold);
      margin-bottom: 6px;
    }
    .lb-title {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      color: #fff;
      margin-bottom: 4px;
    }
    .lb-sub { font-size: 12px; color: rgba(255,255,255,.45); }
    .lb-refresh {
      position: absolute;
      top: 20px; right: 20px;
      font-size: 10px;
      letter-spacing: .12em;
      text-transform: uppercase;
      color: rgba(255,255,255,.4);
    }
    .lb-refresh-dot {
      display: inline-block;
      width: 6px; height: 6px;
      border-radius: 50%;
      background: #4caf50;
      margin-right: 6px;
      animation: pulse 2s infinite;
    }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.3} }

    /* SECTION LABEL */
    .lb-section-label {
      font-size: 10px;
      letter-spacing: .22em;
      text-transform: uppercase;
      color: var(--tmac-bronze);
      margin-bottom: 14px;
      padding-bottom: 8px;
      border-bottom: 1px solid rgba(166,124,82,.2);
    }

    /* LEADERBOARD LIST */
    .lb-list { margin-bottom: 32px; }
    .lb-row {
      background: #fff;
      border: 1px solid rgba(0,0,0,.06);
      padding: 16px 20px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 16px;
      cursor: pointer;
      transition: all .2s;
      text-decoration: none;
    }
    .lb-row:hover { box-shadow: 0 4px 12px rgba(0,0,0,.08); transform: translateY(-1px); }
    .lb-row.not-started { opacity: .5; cursor: default; }
    .lb-row.not-started:hover { box-shadow: none; transform: none; }
    .lb-pos {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      color: var(--charcoal);
      min-width: 36px;
      text-align: center;
      line-height: 1;
    }
    .lb-pos.gold { color: #c9a86c; }
    .lb-pos.silver { color: #999; }
    .lb-pos.bronze-pos { color: #a67c52; }
    .lb-team { flex: 1; }
    .lb-team-name {
      font-size: 15px;
      font-weight: 500;
      color: var(--charcoal);
      margin-bottom: 3px;
    }
    .lb-thru { font-size: 12px; color: #aaa; }
    .lb-score-block { text-align: right; }
    .lb-topar {
      font-family: 'Cormorant Garamond', serif;
      font-size: 28px;
      line-height: 1;
      margin-bottom: 2px;
    }
    .lb-topar.under { color: #2e7d32; }
    .lb-topar.over { color: #c62828; }
    .lb-topar.even { color: var(--charcoal); }
    .lb-topar.ns { color: #ccc; }
    .lb-strokes { font-size: 12px; color: #aaa; }
    .lb-chevron {
      width: 8px; height: 8px;
      border-right: 2px solid #ccc;
      border-bottom: 2px solid #ccc;
      transform: rotate(-45deg);
      flex-shrink: 0;
    }

    /* DRILL-DOWN CARD */
    .drill-card {
      display: none;
      background: #fff;
      border: 1px solid rgba(0,0,0,.08);
      margin-top: -8px;
      margin-bottom: 8px;
      padding: 20px;
      animation: slideDown .2s ease;
    }
    .drill-card.open { display: block; }
    @keyframes slideDown { from{opacity:0;transform:translateY(-8px)} to{opacity:1;transform:translateY(0)} }

    /* DRILL TABLE */
    .drill-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }
    .drill-table th {
      background: var(--deep-forest);
      color: rgba(255,255,255,.6);
      padding: 6px 4px;
      text-align: center;
      font-size: 9px;
      letter-spacing: .1em;
      font-weight: 400;
    }
    .drill-table td {
      padding: 7px 4px;
      text-align: center;
      border-bottom: 1px solid #f5f5f5;
      color: var(--charcoal);
    }
    .drill-table td.h-hole { font-weight: 600; color: var(--deep-forest); font-size: 11px; }
    .drill-table td.h-par { color: #bbb; font-size: 11px; }
    .drill-table td.h-under { color: #2e7d32; font-weight: 600; }
    .drill-table td.h-over { color: #c62828; font-weight: 600; }
    .drill-table td.h-par-score { color: #888; }
    .drill-table td.h-empty { color: #ddd; }
    .drill-table td.h-contest { background: rgba(201,168,108,.06); }
    .drill-table tr.nine-total td { background: #f9f9f9; font-weight: 600; font-size: 11px; border-top: 2px solid #eee; }
    .drill-contest-note { font-size: 11px; color: var(--tmac-bronze); margin-top: 10px; }

    /* CONTESTS SECTION */
    .contests-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
      margin-bottom: 32px;
    }
    .contest-card {
      background: #fff;
      border: 1px solid rgba(0,0,0,.06);
      padding: 16px;
    }
    .contest-card-label {
      font-size: 9px;
      letter-spacing: .18em;
      text-transform: uppercase;
      color: var(--tmac-bronze);
      margin-bottom: 6px;
    }
    .contest-card-hole { font-size: 11px; color: #aaa; margin-bottom: 8px; }
    .contest-card-winner {
      font-family: 'Cormorant Garamond', serif;
      font-size: 18px;
      color: var(--charcoal);
    }
    .contest-card-winner.pending { color: #ccc; font-style: italic; }

    /* LAST UPDATED */
    .last-updated { font-size: 11px; color: #bbb; text-align: center; margin-top: 16px; }

    @media (max-width: 400px) {
      .contests-grid { grid-template-columns: 1fr; }
      .lb-pos { font-size: 22px; }
      .lb-topar { font-size: 22px; }
    }
  </style>
</head>
<body class="member-body">

  <header class="member-header">
    <div class="header-inner">
      <a href="/home.html" class="header-logo">
        <img src="images/tmac-logo.png" alt="TMac Inspired">
      </a>
      <div style="font-family:'Cormorant Garamond',serif;font-size:16px;color:rgba(255,255,255,.8);">Leaderboard</div>
      <a href="/scorecard.html" style="font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--tmac-blush);text-decoration:none;">My Scorecard</a>
    </div>
  </header>

  <div class="practice-banner" id="practice-banner">Practice Mode — Scores do not count</div>

  <div class="lb-wrap">

    <div class="lb-hero">
      <div class="lb-eyebrow">Live Standings</div>
      <div class="lb-title">Tee Elite Invitational</div>
      <div class="lb-sub">Summerfield Crossing · April 18, 2026 · Par 72</div>
      <div class="lb-refresh">
        <span class="lb-refresh-dot"></span>Live
      </div>
    </div>

    <!-- LEADERBOARD -->
    <div class="lb-section-label">Standings</div>
    <div class="lb-list" id="lb-list">
      <div style="text-align:center;padding:40px;color:#aaa;font-size:14px;">Loading standings...</div>
    </div>

    <!-- CONTESTS -->
    <div class="lb-section-label">On-Course Contests</div>
    <div class="contests-grid" id="contests-grid">
      <!-- Populated by JS -->
    </div>

    <div class="last-updated" id="last-updated"></div>
  </div>

  <nav class="pwa-bottom-nav">
    <div class="pwa-bottom-nav-inner">
      <a href="/home.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>Hub
      </a>
      <a href="/leaderboard.html" class="pwa-nav-item active">
        <svg viewBox="0 0 24 24"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Live
      </a>
      <a href="/scorecard.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Score
      </a>
      <a href="/tee-room.html" class="pwa-nav-item">
        <svg viewBox="0 0 24 24"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>Tee Room
      </a>
    </div>
  </nav>

  <script>
    const PARS = [4,3,5,4,4,4,4,3,5,4,4,3,4,4,3,4,4,5];
    const CTP_HOLES = [2,8,12,15];
    const LD_HOLES = [9];
    let openDrill = null;
    let lbData = null;

    async function loadLeaderboard() {
      try {
        const res = await fetch('/api/scores/leaderboard');
        if (!res.ok) return;
        lbData = await res.json();

        // Practice banner
        const banner = document.getElementById('practice-banner');
        if (lbData.mode === 'live') banner.classList.add('hidden');
        else banner.classList.remove('hidden');

        renderLeaderboard(lbData.leaderboard);
        renderContests(lbData.contests);

        const d = new Date(lbData.last_updated);
        document.getElementById('last-updated').textContent =
          'Last updated ' + d.toLocaleTimeString('en-US', { hour: 'numeric', minute: '2-digit' });

      } catch(e) { console.error(e); }
    }

    function renderLeaderboard(teams) {
      const list = document.getElementById('lb-list');
      if (!teams.length) {
        list.innerHTML = '<div style="text-align:center;padding:40px;color:#aaa;">No scores yet. Check back once the round starts.</div>';
        return;
      }

      let pos = 0;
      let prevScore = null;
      list.innerHTML = teams.map((team, idx) => {
        const started = team.holes_completed > 0;
        if (started) {
          if (team.score_to_par !== prevScore) pos = idx + 1;
          prevScore = team.score_to_par;
        }

        const posLabel = !started ? '—' : pos;
        const posClass = pos === 1 ? 'gold' : pos === 2 ? 'silver' : pos === 3 ? 'bronze-pos' : '';
        const thruText = !started ? 'Not started'
          : team.holes_completed === 18 ? 'F'
          : `Thru ${team.holes_completed}`;

        const toPar = team.score_to_par;
        const toParText = toPar === null ? '—'
          : toPar === 0 ? 'E'
          : toPar > 0 ? '+' + toPar : toPar;
        const toParClass = toPar === null ? 'ns'
          : toPar < 0 ? 'under'
          : toPar > 0 ? 'over' : 'even';

        return `
          <div>
            <div class="lb-row ${!started ? 'not-started' : ''}" onclick="${started ? 'toggleDrill(' + team.team_number + ')' : ''}">
              <div class="lb-pos ${posClass}">${posLabel}</div>
              <div class="lb-team">
                <div class="lb-team-name">${team.team_name}</div>
                <div class="lb-thru">${thruText}</div>
              </div>
              <div class="lb-score-block">
                <div class="lb-topar ${toParClass}">${toParText}</div>
                <div class="lb-strokes">${team.total_strokes !== null ? team.total_strokes + ' strokes' : ''}</div>
              </div>
              ${started ? '<div class="lb-chevron"></div>' : ''}
            </div>
            <div class="drill-card" id="drill-${team.team_number}">
              ${buildDrillTable(team)}
            </div>
          </div>`;
      }).join('');
    }

    function buildDrillTable(team) {
      const buildNine = (start, end, label) => {
        let totalPar = 0, totalStrokes = 0, allScored = true;
        let holesHtml = '', parsHtml = '', scoresHtml = '';

        for (let h = start; h <= end; h++) {
          const hData = team.holes.find(x => x.hole === h);
          const par = PARS[h - 1];
          const isContest = CTP_HOLES.includes(h) || LD_HOLES.includes(h);
          const strokes = hData?.strokes;
          const toPar = strokes != null ? strokes - par : null;
          totalPar += par;
          if (strokes != null) totalStrokes += strokes;
          else allScored = false;

          const hClass = isContest ? 'h-hole" style="color:var(--tmac-bronze)' : 'h-hole';
          holesHtml += `<td class="${hClass}">${h}</td>`;
          parsHtml += `<td class="h-par">${par}</td>`;

          if (strokes == null) {
            scoresHtml += `<td class="h-empty">—</td>`;
          } else {
            const cls = toPar < 0 ? 'h-under' : toPar > 0 ? 'h-over' : 'h-par-score';
            scoresHtml += `<td class="${cls}${isContest ? ' h-contest' : ''}">${strokes}</td>`;
          }
        }

        const netToPar = allScored ? totalStrokes - totalPar : null;
        const netLabel = netToPar === null ? '—' : netToPar === 0 ? 'E' : netToPar > 0 ? '+' + netToPar : netToPar;
        const totClass = netToPar !== null ? (netToPar < 0 ? 'h-under' : netToPar > 0 ? 'h-over' : '') : '';

        return `
          <thead>
            <tr>
              <th style="text-align:left;padding-left:6px;">${label}</th>
              ${Array.from({length: end - start + 1}, (_,i) => `<th>${start + i}</th>`).join('')}
            </tr>
          </thead>
          <tbody>
            <tr><td class="h-par" style="text-align:left;padding-left:6px;">Par</td>${parsHtml}</tr>
            <tr><td style="text-align:left;padding-left:6px;font-size:11px;color:#888;">Score</td>${scoresHtml}</tr>
            <tr class="nine-total">
              <td style="text-align:left;padding-left:6px;">${label === 'Front 9' ? 'OUT' : 'IN'}</td>
              <td colspan="${end - start}" class="h-par" style="font-size:10px;">Par ${totalPar}</td>
              <td class="${totClass}">${netLabel}</td>
            </tr>
          </tbody>`;
      };

      // Contest notes for this team
      const ctpNotes = team.holes
        .filter(h => h.ctp_winner && CTP_HOLES.includes(h.hole))
        .map(h => `Hole ${h.hole} CTP: ${h.ctp_winner}`);
      const ldNotes = team.holes
        .filter(h => h.ld_winner && LD_HOLES.includes(h.hole))
        .map(h => `Hole ${h.hole} LD: ${h.ld_winner}`);
      const contestNotes = [...ctpNotes, ...ldNotes];

      return `
        <table class="drill-table">${buildNine(1, 9, 'Front 9')}</table>
        <table class="drill-table" style="margin-top:12px;">${buildNine(10, 18, 'Back 9')}</table>
        ${contestNotes.length ? `<div class="drill-contest-note">${contestNotes.join(' · ')}</div>` : ''}`;
    }

    function toggleDrill(teamNum) {
      const card = document.getElementById(`drill-${teamNum}`);
      if (openDrill && openDrill !== teamNum) {
        document.getElementById(`drill-${openDrill}`).classList.remove('open');
      }
      card.classList.toggle('open');
      openDrill = card.classList.contains('open') ? teamNum : null;
    }

    function renderContests(contests) {
      const grid = document.getElementById('contests-grid');
      const ctpHoles = CTP_HOLES;
      const ldHoles = LD_HOLES;

      const ctpCards = ctpHoles.map(h => `
        <div class="contest-card">
          <div class="contest-card-label">Closest to the Pin</div>
          <div class="contest-card-hole">Hole ${h} · Par 3</div>
          <div class="contest-card-winner ${!contests.ctp[h] ? 'pending' : ''}">${contests.ctp[h] || 'Pending...'}</div>
        </div>`).join('');

      const ldCards = ldHoles.map(h => `
        <div class="contest-card">
          <div class="contest-card-label">Longest Drive</div>
          <div class="contest-card-hole">Hole ${h}</div>
          <div class="contest-card-winner ${!contests.ld[h] ? 'pending' : ''}">${contests.ld[h] || 'Pending...'}</div>
        </div>`).join('');

      grid.innerHTML = ctpCards + ldCards;
    }

    // Auto-refresh every 30 seconds
    loadLeaderboard();
    setInterval(loadLeaderboard, 30000);
  </script>

</body>
</html>
